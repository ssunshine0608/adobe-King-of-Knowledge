<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adobe 知識王挑戰賽</title>
    
    <!-- 確保 React 核心函式庫在運行前載入 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; background-color: #2D2D2D; font-family: 'Noto Sans TC', sans-serif; }
        .touch-highlight { transition: background-color 0.1s; }
        .touch-highlight:active { background-color: rgba(255, 255, 255, 0.3); border-radius: 12px; }
        /* 隱藏捲軸 */
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // ★ 設定區 ★
        // ==========================================
        
        // 【專案路徑】GitHub Pages 的專案名稱，用於構造正確的圖片路徑
        // 注意：請確保所有圖片檔名都已改為小寫（q1.jpg, fengmian.jpg 等）
        const BASE_PATH = "/adobe-King-of-Knowledge/";
        
        // 【點擊區域參數】T:29, H:65, L:7, W:86 - 這是您調整好的精準位置
        const CLICK_AREA_TOP_PERCENT = 29;    
        const CLICK_AREA_HEIGHT_PERCENT = 65; 
        const CLICK_AREA_LEFT_PERCENT = 7;    
        const CLICK_AREA_WIDTH_PERCENT = 86;  

        // ==========================================
        
        const LINE_BOT_ID = "@your_bot_id"; 
        const QUESTIONS = [
            // 請確保這些檔名與您 GitHub 倉庫中的檔案名稱完全匹配
            { id: 1, image: "q1.jpg", correct: 1 }, 
            { id: 2, image: "q2.jpg", correct: 1 },
            { id: 3, image: "q3.jpg", correct: 0 },
            { id: 4, image: "q4.jpg", correct: 2 },
            { id: 5, image: "q5.jpg", correct: 1 }
        ];
        const COVER_IMAGE = "fengmian.jpg"; 

        function getImagePath(fileName) {
            // 修正路徑：確保瀏覽器從專案子路徑開始找檔案
            return BASE_PATH + fileName;
        }

        function App() {
            const [gameState, setGameState] = React.useState('start');
            const [currentQIndex, setCurrentQIndex] = React.useState(0);
            const [score, setScore] = React.useState(0);
            const [userId, setUserId] = React.useState('');
            
            const activeTop = CLICK_AREA_TOP_PERCENT;
            const activeHeight = CLICK_AREA_HEIGHT_PERCENT;
            const activeLeft = CLICK_AREA_LEFT_PERCENT;
            const activeWidth = CLICK_AREA_WIDTH_PERCENT;

            React.useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const uid = params.get('uid');
                if (uid) setUserId(uid);
            }, []);

            const startGame = () => {
                setGameState('playing');
                setScore(0);
                setCurrentQIndex(0);
            };

            const handleAnswer = (optionIndex) => {
                const isCorrect = optionIndex === QUESTIONS[currentQIndex].correct;
                if (isCorrect) setScore(prev => prev + 20);
                
                setTimeout(() => {
                    if (currentQIndex < QUESTIONS.length - 1) {
                        setCurrentQIndex(prev => prev + 1);
                    } else {
                        setGameState('result');
                    }
                }, 200);
            };
            
            const submitScore = () => {
                const message = `【Adobe知識王挑戰】\n我是用戶：${userId || 'Guest'}\n我在 Week 1 獲得了：${score} 分！`;
                window.location.href = `https://line.me/R/oaMessage/${LINE_BOT_ID}/?text=${encodeURIComponent(message)}`;
            };

            if (gameState === 'start') {
                return (
                    <div className="w-full h-screen bg-gray-900 flex flex-col items-center justify-center relative">
                        <div className="w-full max-w-md aspect-square relative shadow-2xl mb-8">
                            <img 
                                src={getImagePath(COVER_IMAGE)} 
                                className="w-full h-full object-cover rounded-lg" 
                                onError={(e)=>e.target.src='https://placehold.co/600x600/333/FFF?text=請確認封面圖'+COVER_IMAGE+'檔名'} />
                        </div>
                        <button onClick={startGame} className="bg-blue-600 text-white font-bold py-4 px-12 rounded-full text-xl shadow-lg animate-bounce">開始挑戰</button>
                    </div>
                );
            }

            if (gameState === 'playing') {
                const currentQ = QUESTIONS[currentQIndex];
                
                return (
                    <div className="w-full h-screen bg-gray-800 flex flex-col items-center justify-start py-4 overflow-hidden relative">
                        <div className="w-full max-w-md relative mt-2 px-2"> 
                            <div className="relative flex justify-center w-full">
                                <img 
                                    src={getImagePath(currentQ.image)} 
                                    className="w-full h-auto object-contain shadow-xl block" 
                                    onError={(e)=>e.target.src='https://placehold.co/600x600/333/FFF?text=請確認題目圖'+currentQ.image+'檔名'} 
                                />

                                {/* 點擊區域 Container */}
                                <div 
                                    className="absolute grid grid-cols-2 grid-rows-2" 
                                    style={{ 
                                        top: `${activeTop}%`, 
                                        height: `${activeHeight}%`,
                                        left: `${activeLeft}%`,
                                        width: `${activeWidth}%`
                                    }}
                                >
                                    <div onClick={() => handleAnswer(0)} className={`touch-highlight flex items-center justify-center`}></div>
                                    <div onClick={() => handleAnswer(1)} className={`touch-highlight flex items-center justify-center`}></div>
                                    <div onClick={() => handleAnswer(2)} className={`touch-highlight flex items-center justify-center`}></div>
                                    <div onClick={() => handleAnswer(3)} className={`touch-highlight flex items-center justify-center`}></div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameState === 'result') {
                return (
                    <div className="w-full h-screen bg-gray-900 flex flex-col items-center justify-center p-4 text-white">
                        <div className="text-6xl font-black mb-6">{score} 分</div>
                        <button onClick={submitScore} className="bg-green-500 text-white font-bold py-4 px-6 rounded-xl">登記成績</button>
                        <button onClick={()=>window.location.reload()} className="bg-gray-700 text-white py-3 px-6 rounded-xl mt-4">再玩一次</button>
                    </div>
                );
            }
            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
